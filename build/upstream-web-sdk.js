!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.upstream=t():e.upstream=t()}(this,(()=>(()=>{var __webpack_modules__={23:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_RESULT__;(function(){"use strict";var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=__webpack_require__.g:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&module.exports,AMD=__webpack_require__.amdO,ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e,t){return function(s){return new Sha256(t,!0).update(s)[e]()}},createMethod=function(e){var t=createOutputMethod("hex",e);NODE_JS&&(t=nodeWrap(t,e)),t.create=function(){return new Sha256(e)},t.update=function(e){return t.create().update(e)};for(var s=0;s<OUTPUT_TYPES.length;++s){var r=OUTPUT_TYPES[s];t[r]=createOutputMethod(r,e)}return t},nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(e){if("string"==typeof e)return crypto.createHash(algorithm).update(e,"utf8").digest("hex");if(null==e)throw new Error(ERROR);return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod},createHmacOutputMethod=function(e,t){return function(s,r){return new HmacSha256(s,t,!0).update(r)[e]()}},createHmacMethod=function(e){var t=createHmacOutputMethod("hex",e);t.create=function(t){return new HmacSha256(t,e)},t.update=function(e,s){return t.create(e).update(s)};for(var s=0;s<OUTPUT_TYPES.length;++s){var r=OUTPUT_TYPES[s];t[r]=createHmacOutputMethod(r,e)}return t};function Sha256(e,t){t?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function HmacSha256(e,t,s){var r,i=typeof e;if("string"===i){var a,n=[],o=e.length,u=0;for(r=0;r<o;++r)(a=e.charCodeAt(r))<128?n[u++]=a:a<2048?(n[u++]=192|a>>6,n[u++]=128|63&a):a<55296||a>=57344?(n[u++]=224|a>>12,n[u++]=128|a>>6&63,n[u++]=128|63&a):(a=65536+((1023&a)<<10|1023&e.charCodeAt(++r)),n[u++]=240|a>>18,n[u++]=128|a>>12&63,n[u++]=128|a>>6&63,n[u++]=128|63&a);e=n}else{if("object"!==i)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR)}e.length>64&&(e=new Sha256(t,!0).update(e).array());var l=[],h=[];for(r=0;r<64;++r){var c=e[r]||0;l[r]=92^c,h[r]=54^c}Sha256.call(this,t,s),this.update(h),this.oKeyPad=l,this.inner=!0,this.sharedMemory=s}Sha256.prototype.update=function(e){if(!this.finalized){var t,s=typeof e;if("string"!==s){if("object"!==s)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR);t=!0}for(var r,i,a=0,n=e.length,o=this.blocks;a<n;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),t)for(i=this.start;a<n&&i<64;++a)o[i>>2]|=e[a]<<SHIFT[3&i++];else for(i=this.start;a<n&&i<64;++a)(r=e.charCodeAt(a))<128?o[i>>2]|=r<<SHIFT[3&i++]:r<2048?(o[i>>2]|=(192|r>>6)<<SHIFT[3&i++],o[i>>2]|=(128|63&r)<<SHIFT[3&i++]):r<55296||r>=57344?(o[i>>2]|=(224|r>>12)<<SHIFT[3&i++],o[i>>2]|=(128|r>>6&63)<<SHIFT[3&i++],o[i>>2]|=(128|63&r)<<SHIFT[3&i++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++a)),o[i>>2]|=(240|r>>18)<<SHIFT[3&i++],o[i>>2]|=(128|r>>12&63)<<SHIFT[3&i++],o[i>>2]|=(128|r>>6&63)<<SHIFT[3&i++],o[i>>2]|=(128|63&r)<<SHIFT[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=o[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var e,t,s,r,i,a,n,o,u,l=this.h0,h=this.h1,c=this.h2,d=this.h3,p=this.h4,f=this.h5,g=this.h6,_=this.h7,E=this.blocks;for(e=16;e<64;++e)t=((i=E[e-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,s=((i=E[e-2])>>>17|i<<15)^(i>>>19|i<<13)^i>>>10,E[e]=E[e-16]+t+E[e-7]+s<<0;for(u=h&c,e=0;e<64;e+=4)this.first?(this.is224?(a=300032,_=(i=E[0]-1413257819)-150054599<<0,d=i+24177077<<0):(a=704751109,_=(i=E[0]-210244248)-1521486534<<0,d=i+143694565<<0),this.first=!1):(t=(l>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),r=(a=l&h)^l&c^u,_=d+(i=_+(s=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&f^~p&g)+K[e]+E[e])<<0,d=i+(t+r)<<0),t=(d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),r=(n=d&l)^d&h^a,g=c+(i=g+(s=(_>>>6|_<<26)^(_>>>11|_<<21)^(_>>>25|_<<7))+(_&p^~_&f)+K[e+1]+E[e+1])<<0,t=((c=i+(t+r)<<0)>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),r=(o=c&d)^c&l^n,f=h+(i=f+(s=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&_^~g&p)+K[e+2]+E[e+2])<<0,t=((h=i+(t+r)<<0)>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),r=(u=h&c)^h&d^o,p=l+(i=p+(s=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(f&g^~f&_)+K[e+3]+E[e+3])<<0,l=i+(t+r)<<0;this.h0=this.h0+l<<0,this.h1=this.h1+h<<0,this.h2=this.h2+c<<0,this.h3=this.h3+d<<0,this.h4=this.h4+p<<0,this.h5=this.h5+f<<0,this.h6=this.h6+g<<0,this.h7=this.h7+_<<0},Sha256.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,s=this.h2,r=this.h3,i=this.h4,a=this.h5,n=this.h6,o=this.h7,u=HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]+HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n];return this.is224||(u+=HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o]),u},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,s=this.h2,r=this.h3,i=this.h4,a=this.h5,n=this.h6,o=this.h7,u=[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,s>>24&255,s>>16&255,s>>8&255,255&s,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24&255,i>>16&255,i>>8&255,255&i,a>>24&255,a>>16&255,a>>8&255,255&a,n>>24&255,n>>16&255,n>>8&255,255&n];return this.is224||u.push(o>>24&255,o>>16&255,o>>8&255,255&o),u},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224,AMD&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return exports}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))})()},742:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExceptionEndpoint=void 0;const r=s(187);t.ExceptionEndpoint="http://api.upstreamapi.com/sdk_exception";t.default=class{sdkKey;upstreamMetadata;seen=new Set;constructor(e){this.sdkKey=e}setUpstreamMetadata(e){this.upstreamMetadata=e}swallow(e,t){this.capture(e,t,(()=>{}))}capture(e,t,s,r){try{const i=t();return i instanceof Promise?i.catch((t=>this.onCaught(e,t,s,r))):i}catch(t){return this.onCaught(e,t,s,r)}}onCaught(e,t,s,i){if(t instanceof r.UpstreamUninitializedError||t instanceof r.UpstreamInvalidArgumentError)throw t;return this.logError(e,t,i),s()}async logError(e,s,r){try{const i="function"==typeof r?await r():null,a=s??Error("[Upstream] Error was empty"),n=a instanceof Error,o=n?a.name:"No Name";if(this.seen.has(o))return;this.seen.add(o);const u=n?a.stack:this.getDescription(a),l=this.upstreamMetadata??{},h=JSON.stringify({tag:e,exception:o,info:u,upstreamMetadata:l,extra:i??{}});fetch(t.ExceptionEndpoint,{method:"POST",headers:{"UPSTREAM-API-KEY":this.sdkKey,"UPSTREAM-SDK-TYPE":String(l.sdkType),"UPSTREAM-SDK-VERSION":String(l.sdkVersion),"Content-Type":"application/json","Content-Length":`${h.length}`},body:h})}catch(e){}}getDescription(e){try{return JSON.stringify(e)}catch{return"[Upstream] Failed to get string for error."}}}},187:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpstreamInvalidArgumentError=t.UpstreamUninitializedError=void 0;class s extends Error{constructor(e){super(e??"Call and wait for initialize() to finish first.")}}t.UpstreamUninitializedError=s;class r extends Error{}t.UpstreamInvalidArgumentError=r},820:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{eventName;user=null;value=null;metadata=null;time;upstreamMetadata;secondaryExposures;constructor(e){this.eventName=e,this.upstreamMetadata={},this.time=Date.now()}getName(){return this.eventName}setValue(e){this.value=e}setMetadata(e){this.metadata=e}addUpstreamMetadata(e,t){this.upstreamMetadata[e]=t}setUser(e){this.user={...e},delete this.user.privateAttributes}setSecondaryExposures(e=[]){this.secondaryExposures=e}toJsonObject(){return{eventName:this.eventName,user:this.user,value:this.value,metadata:this.metadata,time:this.time,upstreamMetadata:this.upstreamMetadata,secondaryExposures:this.secondaryExposures??void 0}}}},967:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpstreamEndpoint=void 0;const i=r(s(960));var a;!function(e){e.Initialize="initialize",e.Rgstr="rgstr",e.LogEventBeacon="log_event_beacon"}(a=t.UpstreamEndpoint||(t.UpstreamEndpoint={}));t.default=class{sdkInternal;retryCodes={408:!0,500:!0,502:!0,503:!0,504:!0,522:!0,524:!0,599:!0};leakyBucket;canUseKeepalive=!1;constructor(e){this.sdkInternal=e,this.leakyBucket={},this.init()}init(){if(!this.sdkInternal.getOptions().getDisableNetworkKeepalive())try{this.canUseKeepalive="keepalive"in new Request("")}catch(e){}}fetchValues(e,t,s,r,i){return this.postWithTimeout(a.Initialize,{user:e,prefetchUsers:i,upstreamMetadata:this.sdkInternal.getUpstreamMetadata()},s,r,t,3)}postWithTimeout(e,t,s,r,i=0,a=0,n=1e3){const o=this.postToEndpoint(e,t,a,n).then((t=>{if(t.ok&&"object"==typeof t.data){const e=t.data;return this.sdkInternal.getErrorBoundary().capture("postWithTimeout",(async()=>(s(e),Promise.resolve(e))),(()=>Promise.resolve({})),(async()=>this.getErrorData(t)))}return Promise.reject(new Error("Request to "+e+" failed with status "+t.status))})).then((()=>{})).catch((e=>("function"==typeof r&&r(e),Promise.reject(e))));if(0!=i){const e=new Promise(((e,t)=>{setTimeout((()=>{t(new Error(`The initialization timeout of ${i}ms has been hit before the network request has completed.`))}),i)}));return Promise.race([o,e])}return o}async postToEndpoint(e,t,s=0,r=1e3,n=!1){if(this.sdkInternal.getOptions().getLocalModeEnabled())return Promise.reject("no network requests in localMode");if("function"!=typeof fetch)return Promise.reject("fetch is not defined");if("undefined"==typeof window)return Promise.reject("window is not defined");const o=(e==a.Initialize?this.sdkInternal.getOptions().getApi():this.sdkInternal.getOptions().getEventLoggingApi())+e,u=this.leakyBucket[o];if(null!=u&&u>=30)return Promise.reject(new Error("Request failed because you are making the same request too frequently."));this.leakyBucket[o]=null==u?1:u+1;let l=JSON.stringify(t),h=e===a.Initialize&&i.default.encodeInitializeCall&&"function"==typeof window?.btoa;if(h)try{l=window.btoa(l).split("").reverse().join("")}catch(e){h=!1}const c={method:"POST",body:l,headers:{"Content-type":"application/json; charset=UTF-8",Authorization:`Bearer ${this.sdkInternal.getSDKKey()}`,"UPSTREAM-CLIENT-TIME":Date.now()+"","UPSTREAM-ENCODED":h?"1":"0"}};return this.canUseKeepalive&&n&&(c.keepalive=!0),fetch(o,c).then((async e=>{if(e.ok){const t=await e.text(),s=e;return s.data=JSON.parse(t),s}this.retryCodes[e.status]||(s=0);const t=await e.text();return Promise.reject(new Error(`${e.status}: ${t}`))})).catch((i=>s>0?new Promise(((i,a)=>{setTimeout((()=>{this.leakyBucket[o]=Math.max(this.leakyBucket[o]-1,0),this.postToEndpoint(e,t,s-1,2*r,n).then(i).catch(a)}),r)})):Promise.reject(i))).finally((()=>{this.leakyBucket[o]=Math.max(this.leakyBucket[o]-1,0)}))}sendLogBeacon(e){if(this.sdkInternal.getOptions().getLocalModeEnabled())return!0;const t=new URL(this.sdkInternal.getOptions().getEventLoggingApi()+a.LogEventBeacon);t.searchParams.append("k",this.sdkInternal.getSDKKey()),e.clientTime=Date.now()+"";let s=null;try{s=JSON.stringify(e)}catch(e){return!1}return navigator.sendBeacon(t.toString(),s)}supportsKeepalive(){return this.canUseKeepalive}async getErrorData(e){try{const t={};return(e.headers??[]).forEach(((e,s)=>{t[s]=e})),{headers:t,status:e.status,statusText:e.statusText,type:e.type,url:e.url,redirected:e.redirected,text:e.data?JSON.stringify(e.data).slice(-100):null}}catch(e){return{statusText:"upstream::failed to extract extra data"}}}}},929:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(742)),a=r(s(967)),n=r(s(406)),o=r(s(230)),u=r(s(92)),l=r(s(899)),h=s(898),c=r(s(302)),d=s(187);t.default=class{ready;appState=null;currentAppState=null;initCalled=!1;pendingInitPromise=null;errorBoundary;sdkKey;identity;network;options;store;logger;constructor(e,t,s){if("string"!=typeof e||!e.startsWith("sk-"))throw new Error("Invalid key provided.  You must use a Client SDK Key from Upstream dashboard to initialize the sdk.");this.errorBoundary=new i.default(e),this.ready=!1,this.sdkKey=e,this.options=new n.default(s),this.identity=new u.default(this.normalizeUser(t??null),this.options.getOverrideStableID()),this.network=new a.default(this),this.store=new o.default(this),this.logger=new l.default(this),null!=s?.initializeValues&&this.setInitializeValues(s?.initializeValues),this.errorBoundary.setUpstreamMetadata(this.getUpstreamMetadata())}initializeCalled(){return this.initCalled}getErrorBoundary(){return this.errorBoundary}getSDKKey(){return null==this.sdkKey?"":this.sdkKey}getCurrentUser(){return this.identity.getUser()}getNetwork(){return this.network}getOptions(){return this.options}getStore(){return this.store}getLogger(){return this.logger}getCurrentUserCacheKey(){return(0,h.getUserCacheKey)(this.getStableID(),this.getCurrentUser())}getUpstreamMetadata(){return this.identity.getUpstreamMetadata()}getSDKType(){return this.identity.getSDKType()}getSDKVersion(){return this.identity.getSDKVersion()}getStableID(){return this.errorBoundary.capture("getStableID",(()=>this.identity.getUpstreamMetadata().stableID),(()=>""))}normalizeUser(e){let t=JSON.parse(JSON.stringify(e));return null!=this.options.getEnvironment()&&(t.upstreamEnvironment=this.options.getEnvironment()),t}handleAppStateChange(e){"active"===this.currentAppState&&e.match(/inactive|background/)?this.logger.flush(!0):this.currentAppState?.match(/inactive|background/)&&"active"===e&&this.logger.sendSavedRequests(),this.currentAppState=e}async initializeAsync(){return this.errorBoundary.capture("initializeAsync",(async()=>{const e=Date.now();if(null!=this.pendingInitPromise)return this.pendingInitPromise;if(this.ready)return Promise.resolve();if(this.initCalled=!0,c.default.asyncStorage&&(await this.identity.initAsync(),await this.store.loadFromAsyncStorage()),this.appState&&this.appState.addEventListener&&"function"==typeof this.appState.addEventListener&&(this.currentAppState=this.appState.currentState,this.appState.addEventListener("change",this.handleAppStateChange.bind(this))),this.options.getLocalModeEnabled())return Promise.resolve();this.pendingInitPromise=this.fetchAndSaveValues(this.identity.getUser(),((t,s)=>{const r=this.options.getInitCompletionCallback();r&&r(Date.now()-e,t,s)})).finally((async()=>{this.pendingInitPromise=null,this.ready=!0,this.logger.sendSavedRequests()}))}),(()=>(this.ready=!0,this.initCalled=!0,Promise.resolve())))}setInitializeValues(e){this.errorBoundary.capture("setInitializeValues",(()=>{this.store.bootstrap(e),this.ready||(this.ready=!0,this.initCalled=!0),this.logger.sendSavedRequests()}),(()=>{this.ready=!0,this.initCalled=!0}))}ensureStoreLoaded(){if(!this.store.isLoaded())throw new d.UpstreamUninitializedError("Call and wait for initialize() to finish first.")}async fetchAndSaveValues(e,t=null){return this.network.fetchValues(e,this.options.getInitTimeoutMs(),(async t=>this.errorBoundary.swallow("fetchAndSaveValues",(async()=>{await this.store.save((0,h.getUserCacheKey)(this.getStableID(),e),t)}))),(e=>{})).then((()=>{t?.(!0,null)})).catch((e=>{t?.(!1,e.message)}))}checkGate(e,t=!1){return this.errorBoundary.capture("checkGate",(()=>{if(this.ensureStoreLoaded(),"string"!=typeof e||0===e.length)throw new d.UpstreamInvalidArgumentError("Must pass a valid string as the gateName.");return this.store.checkGate(e,t)}),(()=>!1))}}},92:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(614),a=s(652),n=r(s(302)),o=r(s(451));t.default=class{user;upstreamMetadata;platform=null;nativeModules=null;reactNativeUUID;sdkType="js-client";sdkVersion;constructor(e,t,r){this.reactNativeUUID=r,this.user=e,this.sdkVersion=s(147).i8??"",this.upstreamMetadata={sessionID:this.getUUID(),sdkType:this.sdkType,sdkVersion:this.sdkVersion};let i=t;n.default.asyncStorage||(i=i??o.default.getItem(a.UPSTREAM_STABLE_ID_KEY)??this.getUUID(),o.default.setItem(a.UPSTREAM_STABLE_ID_KEY,i)),i&&(this.upstreamMetadata.stableID=i)}async initAsync(){let e=this.upstreamMetadata.stableID;return e||(e=await n.default.getItemAsync(a.UPSTREAM_STABLE_ID_KEY),e=e??this.getUUID()),n.default.setItemAsync(a.UPSTREAM_STABLE_ID_KEY,e),this.upstreamMetadata.stableID=e,this}getSDKType(){return this.sdkType}getSDKVersion(){return this.sdkVersion}getUpstreamMetadata(){return this.upstreamMetadata.sdkType=this.sdkType,this.upstreamMetadata.sdkVersion=this.sdkVersion,this.upstreamMetadata}getUser(){return this.user}updateUser(e){this.user=e,this.upstreamMetadata.sessionID=this.getUUID()}setSDKPackageInfo(e){this.sdkType=e.sdkType,this.sdkVersion=e.sdkVersion}setPlatform(e){this.platform=e,this.updateMetadataFromNativeModules()}setNativeModules(e){this.nativeModules=e,this.updateMetadataFromNativeModules()}updateMetadataFromNativeModules(){null!=this.platform&&null!=this.nativeModules&&("android"===this.platform.OS?.toLocaleLowerCase()?this.upstreamMetadata.locale=this.nativeModules.I18nManager?.localeIdentifier:"ios"===this.platform.OS?.toLocaleLowerCase()&&(this.upstreamMetadata.locale=this.nativeModules.SettingsManager?.settings?.AppleLocale||this.nativeModules.SettingsManager?.settings?.AppleLanguages[0]))}getUUID(){return this.reactNativeUUID?.v4()??(0,i.v4)()}setRNDeviceInfo(e){this.upstreamMetadata.appVersion=e.getVersion()??"",this.upstreamMetadata.systemVersion=e.getSystemVersion()??"",this.upstreamMetadata.systemName=e.getSystemName()??"",this.upstreamMetadata.deviceModelName=e.getModel()??"",this.upstreamMetadata.deviceModel=e.getDeviceId()??""}setExpoConstants(e){this.upstreamMetadata.appVersion=e.nativeAppVersion??e.nativeBuildVersion??""}setExpoDevice(e){this.upstreamMetadata.systemVersion=e.osVersion??"",this.upstreamMetadata.systemName=e.osName??"",this.upstreamMetadata.deviceModelName=e.modelName??"",this.upstreamMetadata.deviceModel=e.modelId??""}}},899:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(820)),a=s(967),n=s(652),o=r(s(302)),u=r(s(451)),l="upstream::log_event_failed",h=1024e3;new Set;t.default=class{sdkInternal;queue;flushInterval;loggedErrors;failedLogEvents;exposureDedupeKeys;failedLogEventCount=0;constructor(e){this.sdkInternal=e,this.queue=[],this.flushInterval=null,this.loggedErrors=new Set,this.failedLogEvents=[],this.exposureDedupeKeys={},this.failedLogEventCount=0,this.init()}init(){if("undefined"!=typeof window&&"function"==typeof window.addEventListener&&(window.addEventListener("blur",(()=>this.flush(!0))),window.addEventListener("beforeunload",(()=>this.flush(!0)))),"undefined"!=typeof document&&"function"==typeof document.addEventListener&&document.addEventListener("visibilitychange",(()=>{"visible"!==document.visibilityState&&this.flush(!0)})),"undefined"==typeof window||null==window)return;if(this.sdkInternal.getOptions().getLocalModeEnabled())return;const e=this;this.flushInterval=setInterval((()=>{e.flush()}),this.sdkInternal.getOptions().getLoggingIntervalMillis())}log(e){try{if(!this.sdkInternal.getOptions().getDisableCurrentPageLogging()&&"undefined"!=typeof window&&null!=window&&"object"==typeof window.location&&"string"==typeof window.location.href){const t=window.location.href.split(/[?#]/);t?.length>0&&e.addUpstreamMetadata("currentPage",t[0])}}catch(e){}this.queue.push(e.toJsonObject()),this.queue.length>=this.sdkInternal.getOptions().getLoggingBufferMaxSize()&&this.flush()}resetDedupeKeys(){this.exposureDedupeKeys={}}shouldLogExposure(e){const t=this.exposureDedupeKeys[e],s=Date.now();return!(null!=t&&t>=s-6e5||(this.exposureDedupeKeys[e]=s,0))}logGateExposure(e,t,s,r,a,n){const o=t+String(s)+r+n.reason;if(!this.shouldLogExposure(o))return;const u=new i.default("upstream::gate_exposure");u.setUser(e),u.setMetadata({gate:t,gateValue:String(s),ruleID:r,reason:n.reason,time:n.time}),u.setSecondaryExposures(a),this.log(u)}logConfigExposure(e,t,s,r,a){const n=t+s+a.reason;if(!this.shouldLogExposure(n))return;const o=new i.default("upstream::config_exposure");o.setUser(e),o.setMetadata({config:t,ruleID:s,reason:a.reason,time:a.time}),o.setSecondaryExposures(r),this.log(o)}logLayerExposure(e,t,s,r,a,n,o,u){const l=[t,s,a,n,String(o),u.reason].join("|");if(!this.shouldLogExposure(l))return;const h=new i.default("upstream::layer_exposure");h.setUser(e),h.setMetadata({config:t,ruleID:s,allocatedExperiment:a,parameterName:n,isExplicitParameter:String(o),reason:u.reason,time:u.time}),h.setSecondaryExposures(r),this.log(h)}logAppError(e,t,s){const r=t.substring(0,128);if(this.loggedErrors.has(r)||this.loggedErrors.size>10)return;const a=new i.default("upstream::app_error");a.setUser(e),a.setValue(r),a.setMetadata(s),this.log(a),this.loggedErrors.add(r)}logAppMetrics(e){if("function"!=typeof window?.performance?.getEntriesByType)return;const t=window.performance.getEntriesByType("navigation");if(!t||t.length<1)return;const s=t[0],r={upstream_dimensions:{url:s.name}},a=new i.default("upstream::app_metrics::page_load_time");a.setUser(e),a.setValue(s.duration),a.setMetadata(r),this.log(a);const n=new i.default("upstream::app_metrics::dom_interactive_time");n.setUser(e),n.setValue(s.domInteractive-s.startTime),n.setMetadata(r),this.log(n)}flush(e=!1){if(0===this.queue.length)return;e&&null!=this.flushInterval&&clearInterval(this.flushInterval);const t=this.queue;if(this.queue=[],e&&!this.sdkInternal.getNetwork().supportsKeepalive()&&"undefined"!=typeof navigator&&null!=navigator&&navigator.sendBeacon){return void(this.sdkInternal.getNetwork().sendLogBeacon({events:t,upstreamMetadata:this.sdkInternal.getUpstreamMetadata()})||(this.queue=t.concat(this.queue),this.queue.length>0&&(this.addFailedRequest({events:this.queue,upstreamMetadata:this.sdkInternal.getUpstreamMetadata(),time:Date.now()}),this.queue=[]),this.saveFailedRequests()))}const s=this;this.sdkInternal.getNetwork().postToEndpoint(a.UpstreamEndpoint.Rgstr,{events:t,upstreamMetadata:this.sdkInternal.getUpstreamMetadata()},3,1e3,e).then((e=>{if(!e.ok)throw e})).catch((e=>{if("function"==typeof e.text)e.text().then((r=>{const a=new i.default(l);a.setMetadata({error:`${e.status}: ${r}`}),a.setUser(s.sdkInternal.getCurrentUser()),s.appendFailureLog(a,t)}));else{const r=new i.default(l);r.setMetadata({error:e.message}),r.setUser(s.sdkInternal.getCurrentUser()),s.appendFailureLog(r,t)}})).finally((async()=>{e&&(this.queue.length>0&&(this.addFailedRequest({events:this.queue,upstreamMetadata:this.sdkInternal.getUpstreamMetadata(),time:Date.now()}),this.queue=[]),await s.saveFailedRequests())}))}async saveFailedRequests(){if(this.failedLogEvents.length>0){const e=JSON.stringify(this.failedLogEvents);if(e.length>h)return void this.clearLocalStorageRequests();if(o.default.asyncStorage)return void await o.default.setItemAsync(n.UPSTREAM_LOCAL_STORAGE_LOGGING_REQUEST_KEY,e);u.default.setItem(n.UPSTREAM_LOCAL_STORAGE_LOGGING_REQUEST_KEY,e)}}async sendSavedRequests(){let e,t=!1;if(e=o.default.asyncStorage?await o.default.getItemAsync(n.UPSTREAM_LOCAL_STORAGE_LOGGING_REQUEST_KEY):u.default.getItem(n.UPSTREAM_LOCAL_STORAGE_LOGGING_REQUEST_KEY),null==e)return void this.clearLocalStorageRequests();e.length>h&&(t=!0);let s=[];try{s=JSON.parse(e);for(const e of s)null!=e&&e.events&&Array.isArray(e.events)&&this.sdkInternal.getNetwork().postToEndpoint(a.UpstreamEndpoint.Rgstr,e).then((e=>{if(!e.ok)throw Error(e.status+"")})).catch((s=>{t||this.addFailedRequest(e)}))}catch(e){}finally{this.clearLocalStorageRequests()}}addFailedRequest(e){if(e.time<Date.now()-432e6)return;if(this.failedLogEvents.length>100)return;const t=e.events.length;this.failedLogEventCount+t>1e3||(this.failedLogEvents.push(e),this.failedLogEventCount+=t)}clearLocalStorageRequests(){o.default.asyncStorage?o.default.removeItemAsync(n.UPSTREAM_LOCAL_STORAGE_LOGGING_REQUEST_KEY):u.default.removeItem(n.UPSTREAM_LOCAL_STORAGE_LOGGING_REQUEST_KEY)}appendFailureLog(e,t){this.loggedErrors.has(e.getName())||(this.loggedErrors.add(e.getName()),t.push(e),this.failedLogEvents.push({events:t,upstreamMetadata:this.sdkInternal.getUpstreamMetadata(),time:Date.now()}),this.saveFailedRequests())}}},960:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{static encodeInitializeCall=!1}},406:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{api;disableCurrentPageLogging;environment;loggingIntervalMillis;loggingBufferMaxSize;disableNetworkKeepalive;overrideStableID;localMode;initTimeoutMs;disableErrorLogging;disableAutoMetricsLogging;initializeValues;eventLoggingApi;prefetchUsers;disableLocalStorage;initCompletionCallback;constructor(e){null==e&&(e={});let t=e.api??"http://api.upstreamapi.com";this.api=t.endsWith("/")?t:t+"/",this.disableCurrentPageLogging=e.disableCurrentPageLogging??!1,this.environment=e.environment??null,this.loggingIntervalMillis=this.normalizeNumberInput(e.loggingIntervalMillis,{default:1e4,min:1e3,max:6e4}),this.loggingBufferMaxSize=this.normalizeNumberInput(e.loggingBufferMaxSize,{default:100,min:2,max:500}),this.disableNetworkKeepalive=e.disableNetworkKeepalive??!1,this.overrideStableID=e.overrideStableID??null,this.localMode=e.localMode??!1,this.initTimeoutMs=e.initTimeoutMs&&e.initTimeoutMs>=0?e.initTimeoutMs:3e3,this.disableErrorLogging=e.disableErrorLogging??!1,this.disableAutoMetricsLogging=e.disableAutoMetricsLogging??!1,this.initializeValues=e.initializeValues??null;let s=e.eventLoggingApi??e.api??"http://api.upstreamapi.com";this.eventLoggingApi=s.endsWith("/")?s:s+"/",this.prefetchUsers=e.prefetchUsers??[],this.disableLocalStorage=e.disableLocalStorage??!1,this.initCompletionCallback=e.initCompletionCallback??null}getApi(){return this.api}getEnvironment(){return this.environment}getDisableCurrentPageLogging(){return this.disableCurrentPageLogging}getLoggingIntervalMillis(){return this.loggingIntervalMillis}getLoggingBufferMaxSize(){return this.loggingBufferMaxSize}getDisableNetworkKeepalive(){return this.disableNetworkKeepalive}getOverrideStableID(){return this.overrideStableID}getLocalModeEnabled(){return this.localMode}getInitTimeoutMs(){return this.initTimeoutMs}getDisableErrorLogging(){return this.disableErrorLogging}getDisableAutoMetricsLogging(){return this.disableAutoMetricsLogging}getEventLoggingApi(){return this.eventLoggingApi}getPrefetchUsers(){return this.prefetchUsers}getDisableLocalStorage(){return this.disableLocalStorage}getInitCompletionCallback(){return this.initCompletionCallback}normalizeNumberInput(e,t){return null==e?t.default:Math.max(Math.min(e,t.max),t.min)}}},230:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EvaluationReason=void 0;const i=s(652),a=s(898),n=r(s(302)),o=r(s(451));var u;!function(e){e.Network="Network",e.Bootstrap="Bootstrap",e.Cache="Cache",e.Prefetch="Prefetch",e.Sticky="Sticky",e.LocalOverride="LocalOverride",e.Unrecognized="Unrecognized",e.Uninitialized="Uninitialized",e.Error="Error"}(u=t.EvaluationReason||(t.EvaluationReason={}));t.default=class{sdkInternal;overrides={gates:{}};loaded;values;userValues;stickyDeviceExperiments;userCacheKey;reason;constructor(e){this.sdkInternal=e,this.userCacheKey=this.sdkInternal.getCurrentUserCacheKey(),this.values={},this.userValues={feature_gates:{},dynamic_configs:{},sticky_experiments:{},layer_configs:{},time:0,evaluation_time:0},this.stickyDeviceExperiments={},this.loaded=!1,this.reason=u.Uninitialized,this.loadFromLocalStorage()}updateUser(e){return this.userCacheKey=this.sdkInternal.getCurrentUserCacheKey(),this.setUserValueFromCache(e)}async loadFromAsyncStorage(){this.parseCachedValues(await n.default.getItemAsync(i.INTERNAL_STORE_KEY),await n.default.getItemAsync(i.STICKY_DEVICE_EXPERIMENTS_KEY)),this.loaded=!0}bootstrap(e){const t=this.sdkInternal.getCurrentUserCacheKey();this.loaded=!0;try{this.userValues.feature_gates=e.feature_gates??{},this.userValues.dynamic_configs=e.dynamic_configs??{},this.userValues.layer_configs=e.layer_configs??{},this.userValues.evaluation_time=Date.now(),this.userValues.time=Date.now(),this.values[t]=this.userValues,this.reason=u.Bootstrap,this.loadOverrides()}catch(e){return}}loadFromLocalStorage(){n.default.asyncStorage||(this.parseCachedValues(o.default.getItem(i.INTERNAL_STORE_KEY),o.default.getItem(i.STICKY_DEVICE_EXPERIMENTS_KEY)),this.loaded=!0)}isLoaded(){return this.loaded}parseCachedValues(e,t){try{this.values=e?JSON.parse(e):this.values,this.setUserValueFromCache()}catch(e){this.removeFromStorage(i.INTERNAL_STORE_KEY)}try{const e=t?JSON.parse(t):null;e&&(this.stickyDeviceExperiments=e)}catch(e){this.removeFromStorage(i.STICKY_DEVICE_EXPERIMENTS_KEY)}this.loadOverrides()}setUserValueFromCache(e=!1){let t=this.values[this.userCacheKey];return null==t?(this.resetUserValues(),this.reason=u.Uninitialized,!1):(this.userValues=t,this.reason=e?u.Prefetch:u.Cache,!0)}removeFromStorage(e){n.default.removeItemAsync(e),o.default.removeItem(e)}loadOverrides(){const e=o.default.getItem(i.OVERRIDES_STORE_KEY);if(null!=e)try{this.overrides=JSON.parse(e)}catch(e){o.default.removeItem(i.OVERRIDES_STORE_KEY)}}async save(e,t){const s=t;if(s.prefetched_user_values){const e=Object.keys(s.prefetched_user_values);for(const t of e){const e=s.prefetched_user_values[t];this.values[t]=this.convertAPIDataToCacheValues(e,t)}}if(e){const t=this.convertAPIDataToCacheValues(s,e);this.values[e]=t,e==this.userCacheKey&&(this.userValues=t,this.reason=u.Network)}const r=Object.entries(this.values).sort((({1:e},{1:t})=>null==e?1:null==t?-1:t?.time-e?.time)).slice(0,10);this.values=Object.fromEntries(r),n.default.asyncStorage?await n.default.setItemAsync(i.INTERNAL_STORE_KEY,JSON.stringify(this.values)):o.default.setItem(i.INTERNAL_STORE_KEY,JSON.stringify(this.values))}checkGate(e,t=!1){(0,a.getHashValue)(e);let s,r={value:!1,rule_id:"",secondary_exposures:[]};if(t||null==this.overrides.gates[e]){let t=this.userValues?.feature_gates[e];t&&(r=t),s=this.getEvaluationDetails(null!=t)}else r={value:this.overrides.gates[e],rule_id:"override",secondary_exposures:[]},s=this.getEvaluationDetails(!1,u.LocalOverride);return this.sdkInternal.getLogger().logGateExposure(this.sdkInternal.getCurrentUser(),e,r.value,r.rule_id,r.secondary_exposures,s),!0===r.value}overrideGate(e,t){this.overrides.gates[e]=t,this.saveOverrides()}removeGateOverride(e){null==e?this.overrides.gates={}:delete this.overrides.gates[e],this.saveOverrides()}getAllOverrides(){return this.overrides}saveOverrides(){try{o.default.setItem(i.OVERRIDES_STORE_KEY,JSON.stringify(this.overrides))}catch(e){}}getGlobalEvaluationDetails(){return{reason:this.reason??u.Uninitialized,time:this.userValues.evaluation_time??0}}getEvaluationDetails(e,t){return e?{reason:this.reason,time:this.userValues.evaluation_time??Date.now()}:{reason:t??(this.reason==u.Uninitialized?u.Uninitialized:u.Unrecognized),time:Date.now()}}resetUserValues(){this.userValues={feature_gates:{},dynamic_configs:{},sticky_experiments:{},layer_configs:{},time:0,evaluation_time:0}}convertAPIDataToCacheValues(e,t){return{feature_gates:e.feature_gates,layer_configs:e.layer_configs,dynamic_configs:e.dynamic_configs,sticky_experiments:this.values[t]?.sticky_experiments??{},time:Date.now(),evaluation_time:Date.now()}}}},607:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(187),a=r(s(929)),n=r(s(960));class o{static instance=null;static get encodeIntializeCall(){return n.default.encodeInitializeCall}static set encodeIntializeCall(e){n.default.encodeInitializeCall=e}constructor(){}static async initialize(e,t,s){const r=o.instance??new a.default(e,t,s);return o.instance||(o.instance=r),r.initializeAsync()}static getClientX(){if(!o.instance)throw new i.UpstreamUninitializedError;return o.instance}static checkGate(e,t=!1){return o.getClientX().checkGate(e,t)}}t.default=o},344:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Base64=void 0,t.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_encodeBinary:function(e){for(var t,s,r,i,a,n,o,u="",l=0;l<e.length;)i=(t=e.charCodeAt(l++))>>2,a=(3&t)<<4|(s=e.charCodeAt(l++))>>4,n=(15&s)<<2|(r=e.charCodeAt(l++))>>6,o=63&r,isNaN(s)?n=o=64:isNaN(r)&&(o=64),u=u+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(n)+this._keyStr.charAt(o);return u},encodeArrayBuffer(e){for(var s="",r=new Uint8Array(e),i=r.byteLength,a=0;a<i;a++)s+=String.fromCharCode(r[a]);return t.Base64._encodeBinary(s)}}},652:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_PREFIX=t.LOCAL_STORAGE_KEYS=t.UPSTREAM_LOCAL_STORAGE_LOGGING_REQUEST_KEY=t.UPSTREAM_STABLE_ID_KEY=t.INTERNAL_STORE_KEY=t.STICKY_DEVICE_EXPERIMENTS_KEY=t.OVERRIDES_STORE_KEY=void 0,t.OVERRIDES_STORE_KEY="UPSTREAM_LOCAL_STORAGE_INTERNAL_STORE_OVERRIDES_V3",t.STICKY_DEVICE_EXPERIMENTS_KEY="UPSTREAM_LOCAL_STORAGE_STICKY_DEVICE_EXPERIMENTS",t.INTERNAL_STORE_KEY="UPSTREAM_LOCAL_STORAGE_INTERNAL_STORE_V4",t.UPSTREAM_STABLE_ID_KEY="UPSTREAM_LOCAL_STORAGE_STABLE_ID",t.UPSTREAM_LOCAL_STORAGE_LOGGING_REQUEST_KEY="UPSTREAM_LOCAL_STORAGE_LOGGING_REQUEST",t.LOCAL_STORAGE_KEYS={UPSTREAM_LOCAL_STORAGE_STABLE_ID:!0,UPSTREAM_LOCAL_STORAGE_INTERNAL_STORE_V4:!0,UPSTREAM_LOCAL_STORAGE_STICKY_DEVICE_EXPERIMENTS:!0,UPSTREAM_LOCAL_STORAGE_INTERNAL_STORE_OVERRIDES_V3:!0,UPSTREAM_LOCAL_STORAGE_LOGGING_REQUEST:!0},t.STORAGE_PREFIX="UPSTREAM_LOCAL_STORAGE"},898:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUserCacheKey=t.getHashValue=t.SimpleHash=void 0;const r=s(23),i=s(344);function a(e){for(var t=0,s=0;s<e.length;s++){t=(t<<5)-t+e.charCodeAt(s),t&=t}return String(t)}t.SimpleHash=a,t.getHashValue=function(e){let t=r.sha256.create().update(e).arrayBuffer();return i.Base64.encodeArrayBuffer(t)},t.getUserCacheKey=function(e,t){let s=`userID:${String(t?.userID??"")};stableID:${e}`;const r=t?.customIDs;if(null!=r)for(const[e,t]of Object.entries(r))s+=`;${e}:${t}`;return a(s)}},302:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static asyncStorage;static getItemAsync(e){return s.asyncStorage?s.asyncStorage.getItem(e)??null:Promise.resolve(null)}static setItemAsync(e,t){return s.asyncStorage?s.asyncStorage.setItem(e,t):Promise.resolve()}static removeItemAsync(e){return s.asyncStorage?s.asyncStorage.removeItem(e):Promise.resolve()}}t.default=s},451:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(652);t.default=class{static disabled=!1;static fallbackSessionCache={};static getItem(e){try{if(this.isStorageAccessible())return window.localStorage.getItem(e)}catch(e){}return this.fallbackSessionCache[e]??null}static setItem(e,t){try{if(this.isStorageAccessible())return void window.localStorage.setItem(e,t)}catch(e){}this.fallbackSessionCache[e]=t}static removeItem(e){try{if(this.isStorageAccessible())return void window.localStorage.removeItem(e)}catch(e){}delete this.fallbackSessionCache[e]}static cleanup(){try{if(this.isStorageAccessible(!0))for(var e in window.localStorage)"string"==typeof window.localStorage[e]&&null!=e&&(!this.disabled&&e in r.LOCAL_STORAGE_KEYS||(this.disabled||e.substring(0,r.STORAGE_PREFIX.length)===r.STORAGE_PREFIX)&&window.localStorage.removeItem(e))}catch(e){}}static isStorageAccessible(e=!1){const t="undefined"!=typeof Storage&&"undefined"!=typeof window&&null!=window&&null!=window.localStorage;return(e||!this.disabled)&&t}}},614:(e,t,s)=>{"use strict";var r;s.r(t),s.d(t,{NIL:()=>U,parse:()=>_,stringify:()=>h,v1:()=>g,v3:()=>C,v4:()=>b,v5:()=>O,validate:()=>o,version:()=>L});var i=new Uint8Array(16);function a(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}const n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const o=function(e){return"string"==typeof e&&n.test(e)};for(var u=[],l=0;l<256;++l)u.push((l+256).toString(16).substr(1));const h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!o(s))throw TypeError("Stringified UUID is invalid");return s};var c,d,p=0,f=0;const g=function(e,t,s){var r=t&&s||0,i=t||new Array(16),n=(e=e||{}).node||c,o=void 0!==e.clockseq?e.clockseq:d;if(null==n||null==o){var u=e.random||(e.rng||a)();null==n&&(n=c=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==o&&(o=d=16383&(u[6]<<8|u[7]))}var l=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:f+1,_=l-p+(g-f)/1e4;if(_<0&&void 0===e.clockseq&&(o=o+1&16383),(_<0||l>p)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=l,f=g,d=o;var E=(1e4*(268435455&(l+=122192928e5))+g)%4294967296;i[r++]=E>>>24&255,i[r++]=E>>>16&255,i[r++]=E>>>8&255,i[r++]=255&E;var S=l/4294967296*1e4&268435455;i[r++]=S>>>8&255,i[r++]=255&S,i[r++]=S>>>24&15|16,i[r++]=S>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var m=0;m<6;++m)i[r+m]=n[m];return t||h(i)};const _=function(e){if(!o(e))throw TypeError("Invalid UUID");var t,s=new Uint8Array(16);return s[0]=(t=parseInt(e.slice(0,8),16))>>>24,s[1]=t>>>16&255,s[2]=t>>>8&255,s[3]=255&t,s[4]=(t=parseInt(e.slice(9,13),16))>>>8,s[5]=255&t,s[6]=(t=parseInt(e.slice(14,18),16))>>>8,s[7]=255&t,s[8]=(t=parseInt(e.slice(19,23),16))>>>8,s[9]=255&t,s[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,s[11]=t/4294967296&255,s[12]=t>>>24&255,s[13]=t>>>16&255,s[14]=t>>>8&255,s[15]=255&t,s};function E(e,t,s){function r(e,r,i,a){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],s=0;s<e.length;++s)t.push(e.charCodeAt(s));return t}(e)),"string"==typeof r&&(r=_(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var n=new Uint8Array(16+e.length);if(n.set(r),n.set(e,r.length),(n=s(n))[6]=15&n[6]|t,n[8]=63&n[8]|128,i){a=a||0;for(var o=0;o<16;++o)i[a+o]=n[o];return i}return h(n)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function S(e){return 14+(e+64>>>9<<4)+1}function m(e,t){var s=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(s>>16)<<16|65535&s}function y(e,t,s,r,i,a){return m((n=m(m(t,e),m(r,a)))<<(o=i)|n>>>32-o,s);var n,o}function v(e,t,s,r,i,a,n){return y(t&s|~t&r,e,t,i,a,n)}function A(e,t,s,r,i,a,n){return y(t&r|s&~r,e,t,i,a,n)}function R(e,t,s,r,i,a,n){return y(t^s^r,e,t,i,a,n)}function I(e,t,s,r,i,a,n){return y(s^(t|~r),e,t,i,a,n)}const w=function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var s=0;s<t.length;++s)e[s]=t.charCodeAt(s)}return function(e){for(var t=[],s=32*e.length,r="0123456789abcdef",i=0;i<s;i+=8){var a=e[i>>5]>>>i%32&255,n=parseInt(r.charAt(a>>>4&15)+r.charAt(15&a),16);t.push(n)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[S(t)-1]=t;for(var s=1732584193,r=-271733879,i=-1732584194,a=271733878,n=0;n<e.length;n+=16){var o=s,u=r,l=i,h=a;s=v(s,r,i,a,e[n],7,-680876936),a=v(a,s,r,i,e[n+1],12,-389564586),i=v(i,a,s,r,e[n+2],17,606105819),r=v(r,i,a,s,e[n+3],22,-1044525330),s=v(s,r,i,a,e[n+4],7,-176418897),a=v(a,s,r,i,e[n+5],12,1200080426),i=v(i,a,s,r,e[n+6],17,-1473231341),r=v(r,i,a,s,e[n+7],22,-45705983),s=v(s,r,i,a,e[n+8],7,1770035416),a=v(a,s,r,i,e[n+9],12,-1958414417),i=v(i,a,s,r,e[n+10],17,-42063),r=v(r,i,a,s,e[n+11],22,-1990404162),s=v(s,r,i,a,e[n+12],7,1804603682),a=v(a,s,r,i,e[n+13],12,-40341101),i=v(i,a,s,r,e[n+14],17,-1502002290),s=A(s,r=v(r,i,a,s,e[n+15],22,1236535329),i,a,e[n+1],5,-165796510),a=A(a,s,r,i,e[n+6],9,-1069501632),i=A(i,a,s,r,e[n+11],14,643717713),r=A(r,i,a,s,e[n],20,-373897302),s=A(s,r,i,a,e[n+5],5,-701558691),a=A(a,s,r,i,e[n+10],9,38016083),i=A(i,a,s,r,e[n+15],14,-660478335),r=A(r,i,a,s,e[n+4],20,-405537848),s=A(s,r,i,a,e[n+9],5,568446438),a=A(a,s,r,i,e[n+14],9,-1019803690),i=A(i,a,s,r,e[n+3],14,-187363961),r=A(r,i,a,s,e[n+8],20,1163531501),s=A(s,r,i,a,e[n+13],5,-1444681467),a=A(a,s,r,i,e[n+2],9,-51403784),i=A(i,a,s,r,e[n+7],14,1735328473),s=R(s,r=A(r,i,a,s,e[n+12],20,-1926607734),i,a,e[n+5],4,-378558),a=R(a,s,r,i,e[n+8],11,-2022574463),i=R(i,a,s,r,e[n+11],16,1839030562),r=R(r,i,a,s,e[n+14],23,-35309556),s=R(s,r,i,a,e[n+1],4,-1530992060),a=R(a,s,r,i,e[n+4],11,1272893353),i=R(i,a,s,r,e[n+7],16,-155497632),r=R(r,i,a,s,e[n+10],23,-1094730640),s=R(s,r,i,a,e[n+13],4,681279174),a=R(a,s,r,i,e[n],11,-358537222),i=R(i,a,s,r,e[n+3],16,-722521979),r=R(r,i,a,s,e[n+6],23,76029189),s=R(s,r,i,a,e[n+9],4,-640364487),a=R(a,s,r,i,e[n+12],11,-421815835),i=R(i,a,s,r,e[n+15],16,530742520),s=I(s,r=R(r,i,a,s,e[n+2],23,-995338651),i,a,e[n],6,-198630844),a=I(a,s,r,i,e[n+7],10,1126891415),i=I(i,a,s,r,e[n+14],15,-1416354905),r=I(r,i,a,s,e[n+5],21,-57434055),s=I(s,r,i,a,e[n+12],6,1700485571),a=I(a,s,r,i,e[n+3],10,-1894986606),i=I(i,a,s,r,e[n+10],15,-1051523),r=I(r,i,a,s,e[n+1],21,-2054922799),s=I(s,r,i,a,e[n+8],6,1873313359),a=I(a,s,r,i,e[n+15],10,-30611744),i=I(i,a,s,r,e[n+6],15,-1560198380),r=I(r,i,a,s,e[n+13],21,1309151649),s=I(s,r,i,a,e[n+4],6,-145523070),a=I(a,s,r,i,e[n+11],10,-1120210379),i=I(i,a,s,r,e[n+2],15,718787259),r=I(r,i,a,s,e[n+9],21,-343485551),s=m(s,o),r=m(r,u),i=m(i,l),a=m(a,h)}return[s,r,i,a]}(function(e){if(0===e.length)return[];for(var t=8*e.length,s=new Uint32Array(S(t)),r=0;r<t;r+=8)s[r>>5]|=(255&e[r/8])<<r%32;return s}(e),8*e.length))};const C=E("v3",48,w);const b=function(e,t,s){var r=(e=e||{}).random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){s=s||0;for(var i=0;i<16;++i)t[s+i]=r[i];return t}return h(r)};function M(e,t,s,r){switch(e){case 0:return t&s^~t&r;case 1:case 3:return t^s^r;case 2:return t&s^t&r^s&r}}function T(e,t){return e<<t|e>>>32-t}const k=function(e){var t=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var i=0;i<r.length;++i)e.push(r.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var a=e.length/4+2,n=Math.ceil(a/16),o=new Array(n),u=0;u<n;++u){for(var l=new Uint32Array(16),h=0;h<16;++h)l[h]=e[64*u+4*h]<<24|e[64*u+4*h+1]<<16|e[64*u+4*h+2]<<8|e[64*u+4*h+3];o[u]=l}o[n-1][14]=8*(e.length-1)/Math.pow(2,32),o[n-1][14]=Math.floor(o[n-1][14]),o[n-1][15]=8*(e.length-1)&4294967295;for(var c=0;c<n;++c){for(var d=new Uint32Array(80),p=0;p<16;++p)d[p]=o[c][p];for(var f=16;f<80;++f)d[f]=T(d[f-3]^d[f-8]^d[f-14]^d[f-16],1);for(var g=s[0],_=s[1],E=s[2],S=s[3],m=s[4],y=0;y<80;++y){var v=Math.floor(y/20),A=T(g,5)+M(v,_,E,S)+m+t[v]+d[y]>>>0;m=S,S=E,E=T(_,30)>>>0,_=g,g=A}s[0]=s[0]+g>>>0,s[1]=s[1]+_>>>0,s[2]=s[2]+E>>>0,s[3]=s[3]+S>>>0,s[4]=s[4]+m>>>0}return[s[0]>>24&255,s[0]>>16&255,s[0]>>8&255,255&s[0],s[1]>>24&255,s[1]>>16&255,s[1]>>8&255,255&s[1],s[2]>>24&255,s[2]>>16&255,s[2]>>8&255,255&s[2],s[3]>>24&255,s[3]>>16&255,s[3]>>8&255,255&s[3],s[4]>>24&255,s[4]>>16&255,s[4]>>8&255,255&s[4]]};const O=E("v5",80,k),U="00000000-0000-0000-0000-000000000000";const L=function(e){if(!o(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},147:e=>{"use strict";e.exports={i8:"0.0.0"}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(s.exports,s,s.exports,__webpack_require__),s.exports}__webpack_require__.amdO={},__webpack_require__.d=(e,t)=>{for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(607);return __webpack_exports__=__webpack_exports__.default,__webpack_exports__})()));